<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Spree Ember - An Ember Ecosystem for Spree Commerce</title>
  <link rel="stylesheet" href="">
  <link rel="stylesheet" href="../assets/vendor/prism/prism.css">

  <link rel="stylesheet" href="../assets/vendor/foundation/css/normalize.css">
  <link rel="stylesheet" href="../assets/vendor/foundation/css/foundation.min.css">

  <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,700,300,600,800,400' rel='stylesheet' type='text/css'>

  <link href='http://fonts.googleapis.com/css?family=Cabin:400,500,600,700,400italic,500italic,600italic,700italic' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic' rel='stylesheet' type='text/css'>

  <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="../assets/css/spree-ember.css">

  <meta content="http://www.spree-ember.com/assets/img/share.png" property="og:image">
  <meta content="Spree Ember" property="og:title">
  <meta content="An Ember Ecosystem for Spree Commerce." property="og:description">  
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:creator" content="@_HHFF">
  <meta name="twitter:title" content="Spree Ember">
  <meta name="twitter:description" content="An Ember Ecosystem for Spree Commerce.">
  <meta name="twitter:image" content="http://www.spree-ember.com/assets/img/share.png">

  <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>

<body>
  <header>
    <div class="links">
      <a href="http://www.spree-ember.com/1-overview.html" id="guides-link">Guides</a> -
      <a href="http://www.spree-ember.com/packages.html">API</a> -
      <a href="https://github.com/hhff/spree-ember"><img src="../assets/img/github-120px.png"/> Github</a>
    </div>
    <div class="info">
      <a href="http://www.spree-ember.com">
        <img class="logo" src="../assets/img/logo.svg"/>
      </a>
      <h5>An Ember Ecosystem</h5>
      <h5>For Spree Commerce</h5>
    </div>
  </header>

  <section class="container" id="main">
    <div class="text-center" id="main-package-name">
      <h3><a href="http://www.spree-ember.com/checkouts/index.html">spree-ember-checkouts</a></h3>
    </div>
    <div class="row" id="docs-content">
      <div id="sidebar-content" class="small-12 large-3 columns panel">
<h3>Classes</h3>
<hr>
<ul class="side-nav yuidoc-classes">
    <li><a href="../classes/Mixin.CurrentOrderSupport.html">Mixin.CurrentOrderSupport</a></li>
    <li><a href="../classes/Serializer.Order.html">Serializer.Order</a></li>
    <li><a href="../classes/Service.Checkouts.html">Service.Checkouts</a></li>
</ul>
      </div>
      <div id="main-content" class="small-12 large-9 columns">
<div class="class-definition panel">
  <div class="page-header">
    <h3>Service.Checkouts <small>Class</small></h3>
  </div>

  <div class="well well-small">
      <div class="uses">
        Uses
        <ul class="inline commas">
            <li><a href="Ember.FSM.Stateful.html">Ember.FSM.Stateful</a></li>
        </ul>
      </div>


      <div class="foundat">
        <p>Defined in: <a href="../files/app_services_checkouts.js.html#l2"><code>app&#x2F;services&#x2F;checkouts.js:2</code></a></p>
      </div>


<!--
 -->


  </div>


  <div class="well well-small">
    <p>The checkouts service is a Stateful global for progressing an Order through
the Spree checkout, via the Checkouts endpoint.  It also serves as the
"canonical" state for a Checkout frontend, and should be used to progress
forward and backward through an order's steps.</p>
<p>It's designed to allow a reactive programming style for the checkout
frontend.  The <code>spree-checkout</code> component from the Spree Ember Storefronts
package is an example of this style.</p>
<pre class="code prettyprint"><code class="language-javascript">var checkouts = this.get('spree.checkouts');

checkouts.get('currentState');
// =&gt; "address"

checkouts.transition().then(function() {
  checkouts.get('currentOrder.state');
  // =&gt; "delivery"
  checkouts.get('currentState');
  // =&gt; "delivery"

  checkouts.transition("address").then(function() {

    // Here, the Checkout and Current Order state has diverged.  This is
    // expected behaviour, and their states will reconcile when the 
    // checkout progresses forward again.
    
    checkouts.get('currentOrder.state');
    // =&gt; "delivery"
    checkouts.get('currentState');
    // =&gt; "address"
  });
});
</code></pre>

  </div>

</div>

<div class="panel">
  <ul class="tabs" data-tab>
      <li class="tab-title"><a href="#methods">Methods</a></li>
      <li class="tab-title"><a href="#properties">Properties</a></li>
  </ul>
</div>

<div class="">
  <div class="tabs-content">
      <div class="content" id="methods">
        <h2>Methods</h2>
        <div class="switch round tiny private-toggle">
          <input id="show-private-methods" type="checkbox">
          <label for="show-private-methods"></label>
          <h6>Show Private Methods</h2>
        </div>

<div id="method__ensurePaymentExists" class="method panel item private">
  <h3 class="name"><code>_ensurePaymentExists</code></h3>



<!--
 -->



    <span class="flag private">private</span>





  <div class="meta">
        <p>
            Defined in
    <a href="../files/app_services_checkouts.js.html#l216"><code>app&#x2F;services&#x2F;checkouts.js:216</code></a>
    </p>



  </div>

  <div class="description">
    <p>Called whenever the State Machine enters "Payment".  Ensures that a payment
and source object exists for the <code>currentOrder</code>.</p>

  </div>



</div>
<div id="method__ensureShipAddressExists" class="method panel item private">
  <h3 class="name"><code>_ensureShipAddressExists</code></h3>



<!--
 -->



    <span class="flag private">private</span>





  <div class="meta">
        <p>
            Defined in
    <a href="../files/app_services_checkouts.js.html#l202"><code>app&#x2F;services&#x2F;checkouts.js:202</code></a>
    </p>



  </div>

  <div class="description">
    <p>Called whenever the State Machine enters "Address".  Ensures that an address
object exists for the order's <code>shipAddress</code>.</p>

  </div>



</div>
<div id="method__resetStateMachine" class="method panel item private">
  <h3 class="name"><code>_resetStateMachine</code></h3>



<!--
 -->



    <span class="flag private">private</span>





  <div class="meta">
        <p>
            Defined in
    <a href="../files/app_services_checkouts.js.html#l234"><code>app&#x2F;services&#x2F;checkouts.js:234</code></a>
    </p>



  </div>

  <div class="description">
    <p>When <code>validateOrder</code> fails, the State Machine will automatically transition
to "failed".  Here, we listen to that transition, and then automatically
run this method, to reset the State Machine to the State of the
<code>currentOrder</code>.</p>
<p>Note: Because Ember QUnit relies on returned promise for Unit tests, we
disable this method in <code>test</code>, and manually reset the State Machine when
testing failed transitions.</p>

  </div>



</div>
<div id="method__validateOrder" class="method panel item private">
  <h3 class="name"><code>_validateOrder</code></h3>

    <div class="args">
      <span class="paren">(</span><ul class="args-list inline commas">
        <li class="arg">
            <code>transition</code>
        </li>
      </ul><span class="paren">)</span>
    </div>


<!--
    <p class="returns-inline">
      <span class="type">Ember.RSVP.Promise</span>
    </p>
 -->



    <span class="flag private">private</span>





  <div class="meta">
        <p>
            Defined in
    <a href="../files/app_services_checkouts.js.html#l250"><code>app&#x2F;services&#x2F;checkouts.js:250</code></a>
    </p>



  </div>

  <div class="description">
    <p>Used to save changes to the <code>currentOrder</code> to Spree's Checkouts API.  Is only
called by the state machine when advancing to a later state in the flow.</p>

  </div>


    <div class="params">
      <h4>Parameters:</h4>

      <ul class="params-list">
        <li class="param">
            <code class="param-name">transition</code>
            <span class="type">Transition</span>


          <div class="param-description">
            <p>The current state machine transition.</p>

          </div>

              </li>
          </ul>
      </div>

      <div class="returns">
          <hr />
          <h4>Returns:</h4>

          <div class="returns-description">
                      <span class="type">Ember.RSVP.Promise</span>:
                  <p>A promise that resolves when the server
response returns.</p>

          </div>
      </div>
</div>
<div id="method_transition" class="method panel item">
  <h3 class="name"><code>transition</code></h3>

    <div class="args">
      <span class="paren">(</span><ul class="args-list inline commas">
        <li class="arg">
            <code>stateName</code>
        </li>
      </ul><span class="paren">)</span>
    </div>


<!--
    <p class="returns-inline">
      <span class="type">Ember.RSVP.Promise</span>
    </p>
 -->








  <div class="meta">
        <p>
            Defined in
    <a href="../files/app_services_checkouts.js.html#l170"><code>app&#x2F;services&#x2F;checkouts.js:170</code></a>
    </p>



  </div>

  <div class="description">
    <p>If a state name is passed to this method, the state machine will attempt to
transition directly to that state.  If not, we will attempt to transition
to the next state in the checkout flow.</p>

  </div>


    <div class="params">
      <h4>Parameters:</h4>

      <ul class="params-list">
        <li class="param">
            <code class="param-name">stateName</code>
            <span class="type">String</span>


          <div class="param-description">
            <p>Optional, a state to attempt transition to.</p>

          </div>

              </li>
          </ul>
      </div>

      <div class="returns">
          <hr />
          <h4>Returns:</h4>

          <div class="returns-description">
                      <span class="type">Ember.RSVP.Promise</span>:
                  <p>A promise that resolves when the State Machine
resolves it's transition.</p>

          </div>
      </div>
</div>
      </div>


      <div id="properties" class="content">
        <h2>Properties</h2>
        <div class="switch round tiny private-toggle">
          <input id="show-private-properties" type="checkbox">
          <label for="show-private-properties"></label>
          <h6>Show Private Properties</h2>
        </div>

          <div id="property_currentOrder" class="property panel item">
              <h3 class="name"><code>currentOrder</code></h3>
              <span class="type">DS.Model</span>
          
          
          
          
          
              <div class="meta">
                          <p>
                          Defined in
                  <a href="../files/app_services_checkouts.js.html#l68"><code>app&#x2F;services&#x2F;checkouts.js:68</code></a>
                  </p>
          
          
              </div>
          
              <div class="description">
                  <p>A reference to the Spree Object's <code>currentOrder</code>.</p>
          
              </div>
          
              <hr>
          
          
          
          </div>
          <div id="property_currentState" class="property panel item">
              <h3 class="name"><code>currentState</code></h3>
              <span class="type">String</span>
          
          
          
          
          
              <div class="meta">
                          <p>
                          Defined in
                  <a href="../files/app_services_checkouts.js.html#l43"><code>app&#x2F;services&#x2F;checkouts.js:43</code></a>
                  </p>
          
          
              </div>
          
              <div class="description">
                  <p>Provided by Ember FSM, the current state of the checkout.  This will often
          diverge from the <code>currentOrder.get('state')</code>, and will be reconsoidated when
          the state machine calls <code>validateOrder</code>.  This is what we use as the
          cononical "state" for a frontend's Checkout flow.</p>
          
              </div>
          
              <hr>
          
                  <p><strong>Default: </strong><code>&quot;idle&quot;</code></p>
          
          
          </div>
          <div id="property_fsmEvents" class="property panel item">
              <h3 class="name"><code>fsmEvents</code></h3>
              <span class="type">Object</span>
          
          
          
          
          
              <div class="meta">
                          <p>
                          Defined in
                  <a href="../files/app_services_checkouts.js.html#l84"><code>app&#x2F;services&#x2F;checkouts.js:84</code></a>
                  </p>
          
          
              </div>
          
              <div class="description">
                  <p>Used by Ember FSM to describe the checkout flow.</p>
          
              </div>
          
              <hr>
          
          
          
          </div>
          <div id="property_fsmStates" class="property panel item">
              <h3 class="name"><code>fsmStates</code></h3>
              <span class="type">Object</span>
          
          
          
          
          
              <div class="meta">
                          <p>
                          Defined in
                  <a href="../files/app_services_checkouts.js.html#l75"><code>app&#x2F;services&#x2F;checkouts.js:75</code></a>
                  </p>
          
          
              </div>
          
              <div class="description">
                  <p>Used by Ember FSM to name the <code>initialState</code>.</p>
          
              </div>
          
              <hr>
          
          
          
          </div>
          <div id="property_isLoading" class="property panel item">
              <h3 class="name"><code>isLoading</code></h3>
              <span class="type">Boolean</span>
          
          
          
          
          
              <div class="meta">
                          <p>
                          Defined in
                  <a href="../files/app_services_checkouts.js.html#l53"><code>app&#x2F;services&#x2F;checkouts.js:53</code></a>
                  </p>
          
          
              </div>
          
              <div class="description">
                  <p>Provided by Ember FSM, returns true when there's an active transition.  Handy
          for showing customers loading states during the checkout.</p>
          
              </div>
          
              <hr>
          
                  <p><strong>Default: </strong><code>false</code></p>
          
          
          </div>
          <div id="property_spree" class="property panel item">
              <h3 class="name"><code>spree</code></h3>
              <span class="type">Ember.Service</span>
          
          
          
          
          
              <div class="meta">
                          <p>
                          Defined in
                  <a href="../files/app_services_checkouts.js.html#l61"><code>app&#x2F;services&#x2F;checkouts.js:61</code></a>
                  </p>
          
          
              </div>
          
              <div class="description">
                  <p>A reference to the Spree Service.</p>
          
              </div>
          
              <hr>
          
          
          
          </div>
      </div>



  </div>
</div>
      </div>
    </div>
  </div>

  <footer class="row collapse">
    <div class="small-12 columns text-center">
      <hr />
      <h6>Spree Ember is Open Source under the MIT License.</h6>
      <iframe src="https://ghbtns.com/github-btn.html?user=hhff&repo=spree-ember&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
    </div>
  </footer>

<script src="../assets/vendor/foundation/js/vendor/fastclick.js"></script>
<script src="../assets/vendor/foundation/js/vendor/jquery.js"></script>
<script src="../assets/vendor/foundation/js/vendor/jquery.cookie.js"></script>
<script src="../assets/vendor/foundation/js/vendor/modernizr.js"></script>
<script src="../assets/vendor/foundation/js/vendor/placeholder.js"></script>

<script src="../assets/vendor/foundation/js/foundation.min.js"></script>
<script src="../assets/vendor/prism/prism.js"></script>

<script>$(document).foundation();</script>

<script>
  $('.private-toggle').on('click', function() {
    var $this = $(this);
    var checked = $this.find('input').first().is(':checked');
    if (checked) {
      $this.siblings('.private').css({
        display: 'block'
      })
    } else {
      $this.siblings('.private').css({
        display: 'none'
      })
    }

  })
</script>


</body>
</html>
